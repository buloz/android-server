<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AndroidDemo.MainPage"
             Title="MAUI Server Monitor"
             BackgroundColor="#0f0f23">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Couleurs -->
            <Color x:Key="PrimaryColor">#4ecdc4</Color>
            <Color x:Key="SecondaryColor">#45b7d1</Color>
            <Color x:Key="AccentColor">#ff6b6b</Color>
            <Color x:Key="BackgroundColor">#0f0f23</Color>
            <Color x:Key="CardColor">#1a1a3e</Color>
            <Color x:Key="TextColor">#ffffff</Color>
            <Color x:Key="SubtextColor">#a0a0a0</Color>
            <Color x:Key="SuccessColor">#2ecc71</Color>
            <Color x:Key="ErrorColor">#e74c3c</Color>

            <!-- Gradients -->
            <LinearGradientBrush x:Key="BackgroundGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#0f0f23" Offset="0.0" />
                <GradientStop Color="#1a1a3e" Offset="0.5" />
                <GradientStop Color="#2d1b69" Offset="1.0" />
            </LinearGradientBrush>

            <LinearGradientBrush x:Key="CardGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#1a1a3e" Offset="0.0" />
                <GradientStop Color="#2a2a4e" Offset="1.0" />
            </LinearGradientBrush>

            <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="1,0">
                <GradientStop Color="#4ecdc4" Offset="0.0" />
                <GradientStop Color="#45b7d1" Offset="1.0" />
            </LinearGradientBrush>

            <!-- Styles pour les cartes -->
            <Style x:Key="CardFrame" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource CardColor}" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="CornerRadius" Value="20" />
                <Setter Property="Padding" Value="25" />
                <Setter Property="Margin" Value="10,5" />
                <Setter Property="BorderColor" Value="#33ffffff" />
            </Style>

            <!-- Styles pour les titres -->
            <Style x:Key="CardTitle" TargetType="Label">
                <Setter Property="TextColor" Value="{StaticResource SubtextColor}" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextTransform" Value="Uppercase" />
                <Setter Property="Margin" Value="0,0,0,10" />
            </Style>

            <Style x:Key="CardValue" TargetType="Label">
                <Setter Property="TextColor" Value="{StaticResource TextColor}" />
                <Setter Property="FontSize" Value="28" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Margin" Value="0,5" />
            </Style>

            <Style x:Key="CardSubtitle" TargetType="Label">
                <Setter Property="TextColor" Value="{StaticResource SubtextColor}" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Margin" Value="0,5,0,0" />
            </Style>

            <!-- Style pour le header -->
            <Style x:Key="HeaderFrame" TargetType="Frame">
                <Setter Property="Background" Value="{StaticResource CardGradient}" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="CornerRadius" Value="20" />
                <Setter Property="Padding" Value="25" />
                <Setter Property="Margin" Value="10" />
                <Setter Property="BorderColor" Value="#33ffffff" />
            </Style>

            <!-- Style pour les boutons -->
            <Style x:Key="RefreshButton" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource PrimaryGradient}" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="CornerRadius" Value="25" />
                <Setter Property="HeightRequest" Value="50" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Margin" Value="10" />
            </Style>

            <!-- Style pour les clients -->
            <Style x:Key="ClientCard" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="#2a2a4e" />
                <Setter Property="HasShadow" Value="False" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="Padding" Value="15" />
                <Setter Property="Margin" Value="5" />
                <Setter Property="BorderColor" Value="#33ffffff" />
            </Style>

            <!-- Style pour les endpoints -->
            <Style x:Key="EndpointCard" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="#2a2a4e" />
                <Setter Property="HasShadow" Value="False" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="Padding" Value="15" />
                <Setter Property="Margin" Value="0,5" />
                <Setter Property="BorderColor" Value="#33ffffff" />
            </Style>

            <!-- Animations -->
            <Style x:Key="OnlineIndicator" TargetType="Ellipse">
                <Setter Property="Fill" Value="{StaticResource SuccessColor}" />
                <Setter Property="WidthRequest" Value="12" />
                <Setter Property="HeightRequest" Value="12" />
            </Style>

            <Style x:Key="OfflineIndicator" TargetType="Ellipse">
                <Setter Property="Fill" Value="{StaticResource ErrorColor}" />
                <Setter Property="WidthRequest" Value="12" />
                <Setter Property="HeightRequest" Value="12" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView Background="{StaticResource BackgroundGradient}">
        <VerticalStackLayout Padding="0,20,0,20" Spacing="0">
            
            <!-- Header avec status du serveur -->
            <Frame Style="{StaticResource HeaderFrame}">
                <Grid ColumnDefinitions="*,Auto">
                    
                    <!-- Logo et titre -->
                    <StackLayout Grid.Column="0" Orientation="Horizontal" VerticalOptions="Center">
                        <!-- Icône serveur -->
                        <Frame BackgroundColor="{StaticResource PrimaryColor}" 
                               WidthRequest="40" HeightRequest="40" 
                               CornerRadius="8" Padding="0" Margin="0,0,15,0">
                            <Label Text="⚡" FontSize="24" 
                                   HorizontalOptions="Center" VerticalOptions="Center"
                                   TextColor="White" />
                        </Frame>
                        
                        <StackLayout VerticalOptions="Center">
                            <Label Text="MAUI Server Monitor" 
                                   FontSize="24" FontAttributes="Bold" 
                                   TextColor="{StaticResource TextColor}" />
                            <Label Text="Interface de monitoring en temps réel" 
                                   FontSize="12" 
                                   TextColor="{StaticResource SubtextColor}" />
                        </StackLayout>
                    </StackLayout>
                    
                    <!-- Status indicator -->
                    <Frame Grid.Column="1" 
                           BackgroundColor="#332ecc71"
                           BorderColor="{StaticResource SuccessColor}"
                           CornerRadius="25" Padding="15,8" 
                           VerticalOptions="Center">
                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Ellipse x:Name="StatusIndicator" Style="{StaticResource OnlineIndicator}" />
                            <Label x:Name="StatusLabel" Text="Serveur en ligne" 
                                   TextColor="{StaticResource SuccessColor}" 
                                   FontSize="14" FontAttributes="Bold" 
                                   VerticalTextAlignment="Center" />
                        </StackLayout>
                    </Frame>
                </Grid>
            </Frame>

            <!-- Cartes de statistiques -->
            <Grid RowDefinitions="Auto,Auto,Auto" 
                  ColumnDefinitions="*,*" 
                  RowSpacing="0" ColumnSpacing="0">
                
                <!-- État du serveur -->
                <Frame Grid.Row="0" Grid.ColumnSpan="2" Style="{StaticResource CardFrame}">
                    <StackLayout>
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0" Text="ÉTAT DU SERVEUR" Style="{StaticResource CardTitle}" />
                            <Label Grid.Column="1" Text="✓" FontSize="20" TextColor="{StaticResource SuccessColor}" />
                        </Grid>
                        <Label x:Name="ServerStateLabel" Text="En ligne" Style="{StaticResource CardValue}" 
                               TextColor="{StaticResource SuccessColor}" />
                        <Label Text="Serveur EmbedIO actif" Style="{StaticResource CardSubtitle}" />
                    </StackLayout>
                </Frame>

                <!-- URL du serveur -->
                <Frame Grid.Row="1" Grid.Column="0" Style="{StaticResource CardFrame}">
                    <StackLayout>
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0" Text="URL SERVEUR" Style="{StaticResource CardTitle}" />
                            <Label Grid.Column="1" Text="🔗" FontSize="16" TextColor="{StaticResource PrimaryColor}">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnCopyServerHostPortTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>
                        <Label x:Name="ServerUrlLabel" Text="http://localhost:8080" 
                               Style="{StaticResource CardValue}" FontSize="18" 
                               TextColor="{StaticResource PrimaryColor}" />
                        <Label Text="Adresse d'écoute" Style="{StaticResource CardSubtitle}" />
                    </StackLayout>
                </Frame>

                <!-- Nombre de clients -->
                <Frame Grid.Row="1" Grid.Column="1" Style="{StaticResource CardFrame}">
                    <StackLayout>
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0" Text="CLIENTS WS" Style="{StaticResource CardTitle}" />
                            <Label Grid.Column="1" Text="👥" FontSize="16" TextColor="{StaticResource PrimaryColor}" />
                        </Grid>
                        <Label x:Name="ClientsCountLabel" Text="0" Style="{StaticResource CardValue}" 
                               TextColor="{StaticResource PrimaryColor}" />
                        <Label Text="Connexions actives" Style="{StaticResource CardSubtitle}" />
                    </StackLayout>
                </Frame>
            </Grid>

            <!-- Section clients WebSocket -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout>
                    <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,15">
                        <Label Grid.Column="0" Text="CLIENTS WEBSOCKET CONNECTÉS" 
                               Style="{StaticResource CardTitle}" FontSize="16" />
                        <Label Grid.Column="1" Text="📡" FontSize="18" TextColor="{StaticResource PrimaryColor}" />
                    </Grid>
                    
                    <CollectionView x:Name="ClientsCollectionView" 
                                    ItemsLayout="VerticalGrid, 2"
                                    BackgroundColor="Transparent">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Style="{StaticResource ClientCard}">
                                    <StackLayout>
                                        <Label Text="{Binding ClientId}" 
                                               TextColor="{StaticResource PrimaryColor}" 
                                               FontAttributes="Bold" FontSize="14" />
                                        <Grid ColumnDefinitions="*,*" Margin="0,5,0,0">
                                            <Label Grid.Column="0" Text="{Binding ConnectedTime, StringFormat='Connecté: {0:HH:mm}'}" 
                                                   TextColor="{StaticResource SubtextColor}" FontSize="10" />
                                            <Label Grid.Column="1" Text="{Binding LastActivity, StringFormat='Actif: {0:HH:mm}'}" 
                                                   TextColor="{StaticResource SubtextColor}" FontSize="10" />
                                        </Grid>
                                    </StackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <StackLayout HorizontalOptions="Center" Padding="20">
                                <Label Text="Aucun client connecté" 
                                       TextColor="{StaticResource SubtextColor}" 
                                       HorizontalTextAlignment="Center" />
                            </StackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </StackLayout>
            </Frame>

            <!-- Section endpoints HTTP -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout>
                    <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,15">
                        <Label Grid.Column="0" Text="ENDPOINTS HTTP" 
                               Style="{StaticResource CardTitle}" FontSize="16" />
                        <Label Grid.Column="1" Text="⚡" FontSize="18" TextColor="{StaticResource PrimaryColor}" />
                    </Grid>
                    
                    <CollectionView x:Name="EndpointsCollectionView" BackgroundColor="Transparent">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Style="{StaticResource EndpointCard}">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <!-- Méthode HTTP -->
                                        <Frame Grid.Column="0" 
                                               BackgroundColor="{Binding MethodColor}" 
                                               CornerRadius="12" Padding="8,4" 
                                               VerticalOptions="Center" Margin="0,0,10,0">
                                            <Label Text="{Binding Method}" 
                                                   TextColor="White" FontSize="10" 
                                                   FontAttributes="Bold" />
                                        </Frame>
                                        
                                        <!-- Path -->
                                        <Label Grid.Column="1" Text="{Binding Path}" 
                                               TextColor="{StaticResource PrimaryColor}" 
                                               FontFamily="Courier" FontSize="14" 
                                               VerticalTextAlignment="Center" />
                                        
                                        <!-- Status -->
                                        <Label Grid.Column="2" Text="{Binding Status}" 
                                               TextColor="{StaticResource SuccessColor}" 
                                               FontSize="12" 
                                               VerticalTextAlignment="Center" />
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>

            <!-- Section logs -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout>
                    <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,15">
                        <Label Grid.Column="0" Text="LOGS TEMPS RÉEL" 
                               Style="{StaticResource CardTitle}" FontSize="16" />
                        <Label Grid.Column="1" Text="📋" FontSize="18" TextColor="{StaticResource PrimaryColor}" />
                    </Grid>
                    
                    <Frame BackgroundColor="#1a1a1a" CornerRadius="12" Padding="15" HasShadow="False">
                        <CollectionView x:Name="LogsCollectionView" 
                                        BackgroundColor="Transparent"
                                        HeightRequest="200"
                                        Rotation="180">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <StackLayout Orientation="Horizontal" Spacing="10" Padding="0,2" Rotation="180">
                                        <Label Text="{Binding Time, StringFormat='{0:HH:mm:ss}'}" 
                                               TextColor="#666666" FontFamily="Courier" FontSize="10" 
                                               WidthRequest="60" />
                                        <Label Text="{Binding Message}" 
                                               TextColor="{Binding TextColor}" 
                                               FontFamily="Courier" FontSize="10" 
                                               LineBreakMode="WordWrap" />
                                    </StackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <StackLayout Padding="20" Rotation="180">
                                    <Label Text="Aucun log disponible" 
                                           TextColor="{StaticResource SubtextColor}" 
                                           HorizontalTextAlignment="Center" FontSize="12" />
                                </StackLayout>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </Frame>
                </StackLayout>
            </Frame>

            <!-- Bouton de rafraîchissement -->
            <Button x:Name="RefreshButton" 
                    Text="🔄 Actualiser les données" 
                    Style="{StaticResource RefreshButton}"
                    Clicked="OnRefreshClicked" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
